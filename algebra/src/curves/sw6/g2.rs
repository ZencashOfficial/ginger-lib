//! Model and method interfaces for the Ate pairing pre-computations in G2.

use crate::field_new;
use super::{G1Affine, FQ_ZERO, SW6};
use crate::{
    biginteger::{BigInteger384, BigInteger832},
    curves::{
        models::{ModelParameters, SWModelParameters},
        short_weierstrass_jacobian::{GroupAffine, GroupProjective},
        PairingCurve, PairingEngine,
    },
    fields::sw6::{Fq, Fq3, Fq6, Fr},
};

pub type G2Affine = GroupAffine<SW6G2Parameters>;
pub type G2Projective = GroupProjective<SW6G2Parameters>;

impl PairingCurve for G2Affine {
    type Engine = SW6;
    type Prepared = Self;
    type PairWith = G1Affine;
    type PairingResult = Fq6;

    fn prepare(&self) -> Self::Prepared {
        self.clone()
    }

    fn pairing_with(&self, other: &Self::PairWith) -> Self::PairingResult {
        SW6::pairing(*other, *self)
    }
}

#[derive(Copy, Clone, Default, PartialEq, Eq)]
pub struct SW6G2Parameters;

impl ModelParameters for SW6G2Parameters {
    type BaseField = Fq3;
    type ScalarField = Fr;
}

impl SWModelParameters for SW6G2Parameters {
    /// COEFF_A = G1::COEFF_A * TWIST^2 = (0, 0, 5)
    const COEFF_A: Fq3 = field_new!(Fq3,
        FQ_ZERO,
        FQ_ZERO,
        field_new!(Fq, BigInteger832([
            0x781c76643018bd7a,
            0x64f3a5a4f1d1ad48,
            0xd2f8a1eb4f72692d,
            0xc35eb123c6ed72ca,
            0xb58d6bcfd32de058,
            0x841eab13b02a492c,
            0x4b70dc5a54c487e7,
            0x2f231a8808a74c59,
            0x5e2915154d70b050,
            0x8a40fa16f37a6b37,
            0xd01980093a72c54b,
            0xef6845c25398004c,
            0x48,
        ])),
    );

    /// COEFF_B = G1::COEFF_B * TWIST^3 = G1::COEFF_B * (13,0,0),
    ///
    /// where G1::COEFF_B * 13 =
    /// 7237353553714858194254855835825640240663090882935418626687402315497764\
    /// 1951163185277432483046841596662864163184826853376338289941527237934396\
    /// 2238474054078961275412768865913950955256816477044865425925562831716693\
    /// 4203899992395064470477612
    const COEFF_B: Fq3 = field_new!(Fq3,
        field_new!(Fq, BigInteger832([
            0xc00a9afc5cbce615,
            0x0260c2b730644102,
            0x9051e955661691ec,
            0x15f9af8514839e37,
            0xfa62826ca407172b,
            0x37043dc868f48874,
            0x876b5588d132b025,
            0x481952128335562a,
            0x4ffa729aeddd7dcd,
            0xe181a5dae94a399f,
            0x671fb50145b255d8,
            0xbc3860730482d728,
            0x00000000000023dd,
        ])),
        FQ_ZERO,
        FQ_ZERO,
    );

    /// COFACTOR =
    /// 4327667904591672678288209685150355444429258077786991957470082498694716\
    /// 2516693702667493938255647666346010819253090121562084993205202476199057\
    /// 5551428698926652201555732078009850122416389874723343441742083893031644\
    /// 9269830344819285655155728399734447033483385006597866818437750385669963\
    /// 5686872344035470027430053642178229054516302338812152178131995800255516\
    /// 4741852517324459758376210973933754416624262801543712645471681988343826\
    /// 8105955689132770251651995505331567407698035010923732821685685975893125\
    /// 6208439575383786363605925879337208599843910819433766160937121108797819\
    /// 223653884174994325142959644019600
    const COFACTOR: &'static [u64] = &[
        0x4b77fca151d50b90,
        0x8c98a12bd486d2fb,
        0x1f0c9a51593693f8,
        0x1d6f388069c063c1,
        0x556e918748f06793,
        0x2cea7dc01aae2140,
        0x4216f0595cee44d0,
        0x7a5e400154f633cf,
        0xbb74eb9b6630846b,
        0x8eb48c92998f3358,
        0xbedd37f629e8e634,
        0xc541018fe4d10cc7,
        0x574956a099ace2c3,
        0xa597504275948226,
        0x7ecaaf050acb91f3,
        0x0f25b044f4e9c932,
        0xf8c39cbf0df97780,
        0xd8f9eda95d6abf3e,
        0xd1d80da227dd39c1,
        0x8b589c61531dbce7,
        0xfee4439281455474,
        0x9eea59baa2aeb4a1,
        0xa3b8a42c4e1e6f5a,
        0xc4b99b0d9b077d21,
        0xd09033887d09b4d2,
        0x4a86d8ebb7fdf52a,
        0xbe7ce44dd084e05d,
        0x4ed25f7ebe6c44b3,
        0xd7f8e3ef00255961,
        0xa1ad2ad61580ef78,
        0x19e70d3618ca3,
    ];

    /// COFACTOR^(-1) mod r =
    /// 4558635945721972487314735390173574501346769259429191685520097960457063\
    /// 0929674383405372210802279573887880950375598
    const COFACTOR_INV: Fr = field_new!(Fr, BigInteger384([
        7373687189387546408,
        11284009518041539892,
        301575489693670883,
        13203058298476577559,
        18441611830097862156,
        4115759498196698,
    ]));

    /// AFFINE_GENERATOR_COEFFS = (G2_GENERATOR_X, G2_GENERATOR_Y)
    const AFFINE_GENERATOR_COEFFS: (Self::BaseField, Self::BaseField) =
        (G2_GENERATOR_X, G2_GENERATOR_Y);
}

const G2_GENERATOR_X: Fq3 = field_new!(Fq3, G2_GENERATOR_X_C0, G2_GENERATOR_X_C1, G2_GENERATOR_X_C2);
const G2_GENERATOR_Y: Fq3 = field_new!(Fq3, G2_GENERATOR_Y_C0, G2_GENERATOR_Y_C1, G2_GENERATOR_Y_C2);

/// x-Coordinate of generator, x= c0 + c1*X + c2*X^2
///
/// G2_GENERATOR_X_C0 =
/// 1342676118363094921542559581188503321133289773322844643754626356407844\
/// 5562454176776915160094418980045665397361295624472103734543457352048745\
/// 7265123548959548504289898675429894741362560250459752834156904917519063\
/// 07188562464175510373683338
pub const G2_GENERATOR_X_C0: Fq = field_new!(Fq, BigInteger832([
    0x03b3fe4c8d4ecac7,
    0x9568212677524d1e,
    0xf5de3f2228d187c1,
    0x7bac772e31a420ef,
    0x0255cf59968a612b,
    0x991d4676f6b5d605,
    0x02dd2ae4831d29ea,
    0xbeca7c9a62e392c2,
    0xfc1d0633d48d2fc5,
    0x7867813be5f7d2a1,
    0x6f567b6617030028,
    0xf08c9fa6ca6809df,
    0x0000000000000de9,
]));

/// G2_GENERATOR_X_C1 =
/// 2047160155591888074319817095264590600819851094426865857312935173502834\
/// 3217532386920456705632337352161031960990613816401042894531220068552819\
/// 8180376055133595621183635891995693214215586961256468676613604983231710\
/// 27455638052943806292028610
pub const G2_GENERATOR_X_C1: Fq = field_new!(Fq, BigInteger832([
    0xefd1b506e5fbe05f,
    0xad27d47a4975140c,
    0xfa11540132dbc27a,
    0x8dca42b6da7c4717,
    0x66d30fd7fd76207a,
    0xb8e4f65c68932b1d,
    0x3b7f971e93ad14be,
    0xf860a89f4e582f9f,
    0x7d438aaa3986f73b,
    0xa37ec0c18c6e106a,
    0x9f2dfb98b5185b54,
    0x19995e421ca939bc,
    0x0000000000002f4f,
]));

/// G2_GENERATOR_X_C2 =
/// 3905053196875761830053608605277158152930144841844497593936739534395003\
/// 0626854498463814313311693699105359351381163204423455247582174117790272\
/// 7088319385699969158283133984560093830471991650194038109381578140818322\
/// 7875600753651697934495980
pub const G2_GENERATOR_X_C2: Fq = field_new!(Fq, BigInteger832([
    0xc081ed832bdf911e,
    0xb85ff7aeebdfe7b3,
    0x96dce6bb307b14eb,
    0x578f7ded84bd824c,
    0xb799305a9971d184,
    0x0116ad33c2874b90,
    0x862dce68efdca245,
    0x4190947c70534c1d,
    0x1b1aa80334248d03,
    0xb13b07aff63fcf27,
    0x5727687b73ab4fff,
    0xf559a7f4eb8d180a,
    0x0000000000002d37,
]));

/// y-Coordinate of generator, y= c0 + c1*X + c2*X^2
///
/// G2_GENERATOR_Y_C0 =
/// 8567517639523571619872938228644013584947463594196306323477160496987712\
/// 1115766247029394727659939955868895325590391690987808925055985895811477\
/// 6809509353698844601025561152373670601758068633540446920748659427210371\
/// 7837888228343074699140243
pub const G2_GENERATOR_Y_C0: Fq = field_new!(Fq, BigInteger832([
    0x3f680b59e26b33d1,
    0x720fdf65b9e15b17,
    0x0f0b56def11247b1,
    0x5ea05417c8a4a52c,
    0x4ad59dc4f7c47a09,
    0xf393e0db62107115,
    0xde3b16404a53d2bb,
    0xeaa74961636280e0,
    0x2d16ccd14cf5a88c,
    0x5667565a06187d0e,
    0xb446fdc7565d0261,
    0xd3ad395d6fd0faab,
    0x0000000000000655,
]));

/// G2_GENERATOR_Y_C1 =
/// 3890537069205870914984502594450293167889863914413852788876350245583932\
/// 8469801260250439740707042958572262115471080056503998704580897215185594\
/// 8087050315980453009155988614968071853100477869798291025370155919433798\
/// 7238111062202037698927752
pub const G2_GENERATOR_Y_C1: Fq = field_new!(Fq, BigInteger832([
    0x9e86cc63207679dd,
    0x4e16d9a9d87c3e47,
    0xdbee3524db80627d,
    0x137322b87d93befc,
    0x24a7ca2f9aae90a0,
    0x44abea538df3e854,
    0xc01d176c6e042eee,
    0xf5fcc4caabc75699,
    0x1f99972699a38960,
    0x30d4cc8256bf963d,
    0xa3634826edcfefff,
    0x34f3bd0c8e5a4b38,
    0x0000000000001d28,
]));

/// G2_GENERATOR_Y_C2 =
/// 1093626992261261556427118830310459336272475428414377905159974901673504\
/// 1389483971486958818324356025479751246744831831158558101688599198721653\
/// 9217230130623336364026171188470090854851662841269705985613934119164612\
/// 54016145116183331671450721
pub const G2_GENERATOR_Y_C2: Fq = field_new!(Fq, BigInteger832([
    0xfc478105dedf3654,
    0xa6fcfcfdd2710d6a,
    0x05a68c283d5d4c65,
    0x9fab8d94c667a679,
    0x009b0a616ea54ff9,
    0xf0df517bc7bc6382,
    0xdb44338e7491f5b7,
    0xcd192a7e53453f45,
    0xa041a7a60982d92c,
    0x4dd01c62bae4c7ff,
    0x79a69a54e6b66178,
    0xd47b0bfe832b05f8,
    0x00000000000000ef,
]));
